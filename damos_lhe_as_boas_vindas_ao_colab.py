# -*- coding: utf-8 -*-
"""Damos-lhe as boas-vindas ao Colab

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/notebooks/intro.ipynb
"""

# ğŸ“¦ Importar bibliotecas
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix
import joblib

df = pd.read_csv("/dataset_safezone_rico.csv")  # certifique-se que o CSV estÃ¡ no mesmo diretÃ³rio
print("VisualizaÃ§Ã£o inicial:")
print(df.head())

# ğŸ“ Verificar distribuiÃ§Ã£o por regiÃ£o
print("\nRegistros por regiÃ£o:")
print(df['regiao'].value_counts())

# ğŸ” Codificar a variÃ¡vel categÃ³rica 'regiao'
df_encoded = pd.get_dummies(df, columns=['regiao'])
print("\nApÃ³s codificaÃ§Ã£o:")
print(df_encoded.head())

# âœ‚ï¸ Separar features e alvo
X = df_encoded.drop("alerta", axis=1)
y = df_encoded["alerta"]

# ğŸ”€ Dividir entre treino e teste
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)

# ğŸ§  Treinamento do modelo
model = RandomForestClassifier()
model.fit(X_train, y_train)

# âœ… AvaliaÃ§Ã£o do modelo
y_pred = model.predict(X_test)
print("\nMatriz de confusÃ£o:")
print(confusion_matrix(y_test, y_pred))

print("\nRelatÃ³rio de classificaÃ§Ã£o:")
print(classification_report(y_test, y_pred))

# ğŸ“ˆ VisualizaÃ§Ã£o dos dados
sns.boxplot(x="alerta", y="nivel_agua", data=df)
plt.title("DistribuiÃ§Ã£o do NÃ­vel de Ãgua por Alerta")
plt.show()

sns.countplot(x="regiao", hue="alerta", data=df)
plt.title("Alertas por RegiÃ£o")
plt.xticks(rotation=45)
plt.show()

# ğŸ’¾ Exportar o modelo treinado
joblib.dump(model, "modelo_safezone.pkl")
print("\nModelo salvo como 'modelo_safezone.pkl'")

# ğŸ¤– PrevisÃ£o personalizada com cenÃ¡rios
print("\nğŸ” PrevisÃ£o personalizada por cenÃ¡rio:")
cenarios = {
    "1": {"temperatura": 30, "umidade": 45, "nivel_agua": 20, "descricao": "CÃ©u limpo, clima seco"},
    "2": {"temperatura": 26, "umidade": 70, "nivel_agua": 50, "descricao": "Chuva moderada"},
    "3": {"temperatura": 24, "umidade": 90, "nivel_agua": 85, "descricao": "Chuva forte, nÃ­vel elevado"}
}

print("CenÃ¡rios disponÃ­veis:")
for k, v in cenarios.items():
    print(f"{k} - {v['descricao']}")

opcao = input("Escolha o nÃºmero do cenÃ¡rio desejado: ")

regioes_possiveis = ['Centro', 'Zona Norte', 'Zona Sul', 'Zona Leste', 'Zona Oeste', 'Interior', 'Litoral']
regiao_input = input("Informe sua regiÃ£o (exatamente como: Centro, Zona Norte, etc): ")

if opcao not in cenarios or regiao_input not in regioes_possiveis:
    print("âŒ OpÃ§Ã£o ou regiÃ£o invÃ¡lida.")
else:
    dados = cenarios[opcao]

    dados_usuario = {
        'temperatura': dados['temperatura'],
        'umidade': dados['umidade'],
        'nivel_agua': dados['nivel_agua']
    }

    for reg in regioes_possiveis:
        dados_usuario[f'regiao_{reg}'] = 1 if reg == regiao_input else 0

    df_usuario = pd.DataFrame([dados_usuario])
    df_usuario = df_usuario[X.columns]
    resultado = model.predict(df_usuario)[0]


    print(f"\nğŸ“ RegiÃ£o: {regiao_input}")
print(f"ğŸŒ¡ï¸ Temperatura: entre {dados['temperatura'] - 1}Â°C e {dados['temperatura'] + 1}Â°C")
print(f"ğŸ’§ Umidade: entre {dados['umidade'] - 5}% e {dados['umidade'] + 5}%")
print(f"ğŸŒŠ NÃ­vel de Ã¡gua: entre {dados['nivel_agua'] - 5} e {dados['nivel_agua'] + 5}")

if resultado == 1:
    print("ğŸš¨ ALERTA: HÃ¡ risco elevado de enchente na sua regiÃ£o!")
else:
    print("âœ… SituaÃ§Ã£o segura: Nenhum risco elevado identificado no momento.")